<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Paris Trip & Flight Weather</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="paris-christmas-markets.jpg">

  <style>
    :root {
      --bg: #0b1020;
      --panel: rgba(20, 27, 51, .78);
      --good: #2ecc71;
      --bad: #e74c3c;
      --wait: #95a5a6;
      --text: #f5f5f5;
      --muted: #aabbcc;
      --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font);
      background: linear-gradient(rgba(0,0,0,.55), rgba(0,0,0,.55)),
                  url("paris-christmas-markets.jpg") center/cover fixed;
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 1rem;
    }

    #cols {
      display: flex;
      gap: 1.5rem;
      width: 100%;
      max-width: 1500px;
    }

    .panel {
      background: var(--panel);
      backdrop-filter: blur(8px);
      border-radius: 12px;
      padding: 1.25rem 1.5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,.45);
      overflow-y: auto;
      max-height: 95vh;
      scroll-behavior: smooth;
    }

    #itin { flex: 1; }
    #weather { flex: 0 0 42%; }

    h1, h2 { margin: 0 0 .6rem; text-align: center; }
    h1 { font-size: 1.5rem; }
    h2 { font-size: 1rem; color: var(--muted); font-weight: 400; }

    details {
      margin-bottom: .9rem;
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 8px;
      padding: .5rem .75rem;
      transition: background .2s;
    }
    details[open] { background: rgba(255,255,255,.04); }
    summary {
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      outline: none;
    }
    summary::-webkit-details-marker { color: var(--muted); }

    ul { margin: .5rem 0 0 1.1rem; padding: 0; }
    li { margin-bottom: .35rem; font-size: .92rem; }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: .85rem;
    }
    thead th {
      position: sticky;
      top: 0;
      background: var(--panel);
      z-index: 1;
      padding: .6rem .5rem;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    tbody td {
      padding: .55rem .5rem;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    th:nth-child(1), td:nth-child(1) { width: 36%; }
    th:nth-child(2), td:nth-child(2) { width: 22%; }
    th:nth-child(3), td:nth-child(3) { width: 22%; }
    th:nth-child(4), td:nth-child(4) { width: 20%; text-align: center; }

    .tag {
      display: inline-block;
      padding: .25rem .6rem;
      border-radius: 999px;
      font-weight: 600;
      font-size: .75rem;
      text-decoration: none;
      transition: transform .15s;
    }
    .tag:hover { transform: scale(1.05); }
    .good { background: rgba(46,204,113,.18); color: var(--good); border: 1px solid var(--good); }
    .bad  { background: rgba(231,76,60,.18); color: var(--bad);  border: 1px solid var(--bad); }
    .wait { background: rgba(149,165,166,.18); color: var(--wait); border: 1px solid var(--wait); }

    .small { font-size: .75rem; color: var(--muted); }

    #footer {
      text-align: center;
      font-size: .75rem;
      color: var(--muted);
      margin-top: .75rem;
    }

    #countdown {
      text-align: center;
      font-size: .9rem;
      margin-bottom: .75rem;
      color: var(--muted);
    }

    @media (max-width: 800px) {
      body { display: block; padding: .5rem; }
      #cols { flex-direction: column; gap: 1rem; }
      .panel { max-height: none; width: 100%; }
    }
  </style>
</head>

<body>
<div id="cols">

  <!-- ITINERARY -->
  <section id="itin" class="panel">
    <h1>Paris Itinerary</h1>
    <h2>2 – 8 December 2025</h2>

    <details open>
      <summary>Day 1 – Tuesday 2 Dec</summary>
      <ul>
        <li>11:05 Land CDG</li>
        <li>12:15 RER B → Denfert-Rochereau → M6 Place d’Italie</li>
        <li>13:15 Check-in 7 Av. Stephen-Pichon</li>
        <li>14:00 Chinatown stroll</li>
        <li>14:30 Lunch near Tang Frères</li>
        <li>16:00 Métro to Bastille</li>
        <li>16:15 Coulée Verte walk</li>
        <li>17:30 Drink at Le Train Bleu</li>
        <li>18:45 Dinner Afrik’N’Fusion</li>
        <li>20:30 Walk home</li>
      </ul>
    </details>

    <details>
      <summary>Day 2 – Wednesday 3 Dec</summary>
      <ul>
        <li>09:00 Sainte-Chapelle</li>
        <li>09:45 Conciergerie</li>
        <li>10:30 Notre-Dame (exterior)</li>
        <li>11:00 Pont Neuf & Pont des Arts</li>
        <li>11:30 Jardin du Luxembourg</li>
        <li>12:15 Huîtrerie Régis</li>
        <li>14:00 Musée d’Orsay</li>
        <li>19:00 Chez Gladines</li>
      </ul>
    </details>

    <details>
      <summary>Day 3 – Thursday 4 Dec</summary>
      <ul>
        <li>09:00 Louvre – 19th-century rooms</li>
        <li>11:30 Tuileries Garden</li>
        <li>12:15 Chez Alain Miam Miam</li>
        <li>13:30 Walk toward Passy</li>
        <li>14:30 Maison de Balzac</li>
        <li>16:00 Trocadéro</li>
        <li>19:00 Le Temps des Cerises</li>
      </ul>
    </details>

    <details>
      <summary>Day 4 – Friday 5 Dec</summary>
      <ul>
        <li>07:00 Métro → Opéra → Gare Saint-Lazare</li>
        <li>08:14 Train to Rouen</li>
        <li>09:46 Taxi to Cathedral</li>
        <li>10:00 Gros Horloge</li>
        <li>12:00 Vegan & Cie</li>
        <li>13:00 Musée Flaubert</li>
        <li>14:00 Cimetière Monumental</li>
        <li>14:30 Croisset</li>
        <li>18:00 Train back</li>
        <li>Dinner Brasserie Le Lazare</li>
      </ul>
    </details>

    <details>
      <summary>Day 5 – Saturday 6 Dec</summary>
      <ul>
        <li>09:00 Belleville</li>
        <li>10:00 Promenade Dora Bruder</li>
        <li>11:30 Montmartre</li>
        <li>12:00 Sacré-Cœur</li>
        <li>14:00 Père Lachaise</li>
        <li>17:00 Pain Vin Fromages</li>
      </ul>
    </details>

    <details>
      <summary>Day 6 – Sunday 7 Dec</summary>
      <ul>
        <li>09:00 Parc Montsouris</li>
        <li>10:15 Covered passages</li>
        <li>12:00 Tuileries Christmas Market</li>
        <li>14:15 Galeries Lafayette</li>
        <li>16:00 Carrefour Italie 2</li>
        <li>18:00 Darkoum Cantine Marocaine</li>
      </ul>
    </details>

    <details>
      <summary>Day 7 – Monday 8 Dec</summary>
      <ul>
        <li>06:15 Leave apartment</li>
        <li>06:30 Métro → RER B → CDG</li>
        <li>07:30 Arrive airport</li>
        <li>10:30 Flight departs</li>
      </ul>
    </details>
  </section>

  <!-- WEATHER -->
  <section id="weather" class="panel">
    <h1>Flight Weather</h1>
    <h2>Conditions at departure / arrival</h2>

    <div id="countdown" aria-live="polite">Loading countdown…</div>

    <table aria-live="polite">
      <thead>
        <tr>
          <th>Segment</th>
          <th>Local Time</th>
          <th>Summary</th>
          <th>Weather</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>

    <div id="footer">Data from Open-Meteo · Refreshes every 30 min</div>
  </section>

</div>

<script>
/* ---------- CONFIG ---------- */
const airports = {
  ATW: { code: "ATW", name: "Appleton ATW", lat: 44.2581, lon: -88.5191, tz: "America/Chicago" },
  DTW: { code: "DTW", name: "Detroit DTW", lat: 42.2162, lon: -83.3554, tz: "America/New_York" },
  CDG: { code: "CDG", name: "Paris CDG",   lat: 49.0097, lon:  2.5479, tz: "Europe/Paris" }
};

const events = [
  { id:"ATW_TAKE",  label:"ATW → DTW take-off",  airport:"ATW", iso:"2025-12-01T17:21:00-06:00" },
  { id:"DTW_LAND1", label:"ATW → DTW landing",   airport:"DTW", iso:"2025-12-01T19:43:00-05:00" },
  { id:"DTW_TAKE",  label:"DTW → CDG take-off",  airport:"DTW", iso:"2025-12-01T21:20:00-05:00" },
  { id:"CDG_LAND",  label:"DTW → CDG landing",   airport:"CDG", iso:"2025-12-02T11:05:00+01:00" },
  { id:"CDG_TAKE",  label:"CDG → DTW take-off",  airport:"CDG", iso:"2025-12-08T10:30:00+01:00" },
  { id:"DTW_LAND2", label:"CDG → DTW landing",   airport:"DTW", iso:"2025-12-08T13:45:00-05:00" },
  { id:"DTW_TAKE2", label:"DTW → ATW take-off",  airport:"DTW", iso:"2025-12-08T16:50:00-05:00" },
  { id:"ATW_LAND",  label:"DTW → ATW landing",   airport:"ATW", iso:"2025-12-08T17:14:00-06:00" }
];

/* ---------- HELPERS ---------- */
const tbody = document.getElementById("rows");
const cache = new Map();

function fmt(date) {
  return new Intl.DateTimeFormat("en-US", {
    month: "short", day: "numeric", hour: "2-digit", minute: "2-digit", hour12: false
  }).format(date);
}

function fahrenheit(c) { return Math.round(c * 9/5 + 32); }

function classify(code, wind, prec) {
  const bad = [65,66,67,71,73,75,77,80,81,82,85,86,95,96,99];
  if (bad.includes(code) || wind >= 45 || prec >= 4) return "BAD";
  return "GOOD";
}

function describe(code) {
  const map = {
    0:"Clear",1:"Mainly clear",2:"Partly cloudy",3:"Overcast",
    45:"Fog",48:"Rime fog",51:"Light drizzle",53:"Drizzle",55:"Heavy drizzle",
    61:"Light rain",63:"Moderate rain",65:"Heavy rain",
    71:"Light snow",73:"Snow",75:"Heavy snow",
    80:"Showers",81:"Showers",82:"Heavy showers",
    95:"Thunderstorm",96:"Storm w/ hail",99:"Severe hail"
  };
  return map[code] || "Weather";
}

function nearestIndex(times, target) {
  const t = target.getTime();
  return times.reduce((best, cur, i) =>
    Math.abs(new Date(cur).getTime() - t) < Math.abs(new Date(times[best]).getTime() - t) ? i : best, 0);
}

/* ---------- FETCH ---------- */
async function fetchForecast(ap) {
  if (cache.has(ap.code)) return cache.get(ap.code);
  const url = `https://api.open-meteo.com/v1/forecast`
            + `?latitude=${ap.lat}&longitude=${ap.lon}`
            + `&hourly=temperature_2m,weathercode,precipitation,windspeed_10m`
            + `&timezone=${encodeURIComponent(ap.tz)}&forecast_days=16`;
  try {
    const r = await fetch(url);
    if (!r.ok) throw new Error("HTTP " + r.status);
    const data = await r.json();
    cache.set(ap.code, data);
    return data;
  } catch (e) {
    console.error("Weather fetch failed:", e);
    return null;
  }
}

/* ---------- RENDER ---------- */
function initialRender() {
  tbody.innerHTML = "";
  events.forEach(ev => {
    const ap = airports[ev.airport];
    const tr = document.createElement("tr");
    tr.id = "row_" + ev.id;
    tr.innerHTML = `
      <td><strong>${ev.label}</strong><br><span class="small">${ap.name}</span></td>
      <td>${fmt(new Date(ev.iso))}</td>
      <td class="small">Loading…</td>
      <td><span class="tag wait">WAIT</span></td>
    `;
    tbody.appendChild(tr);
  });
}

async function updateAll() {
  const byAirport = {};
  events.forEach(ev => (byAirport[ev.airport] ||= []).push(ev));

  for (const code of Object.keys(byAirport)) {
    const ap = airports[code];
    const data = await fetchForecast(ap);
    if (!data) continue;

    const { time, temperature_2m, weathercode, precipitation, windspeed_10m } = data.hourly;
    byAirport[code].forEach(ev => {
      const row = document.getElementById("row_" + ev.id);
      const idx = nearestIndex(time, new Date(ev.iso));

      const t = temperature_2m[idx];
      const p = precipitation[idx];
      const w = windspeed_10m[idx];
      const c = weathercode[idx];

      const rating = classify(c, w, p);
      const summary = `${describe(c)}; ${fahrenheit(t)} °F`;

      row.children[2].textContent = summary;
      const link = `forecast.html?airport=${ap.code}&time=${encodeURIComponent(ev.iso)}`;
      row.children[3].innerHTML =
        `<a class="tag ${rating.toLowerCase()}" href="${link}" target="_blank">${rating}</a>`;
    });
  }
}

/* ---------- COUNTDOWN ---------- */
function updateCountdown() {
  const now = Date.now();
  const next = events.find(ev => new Date(ev.iso).getTime() > now);
  const el = document.getElementById("countdown");
  if (!next) { el.textContent = "All flights completed"; return; }

  const diff = new Date(next.iso).getTime() - now;
  const d = Math.floor(diff / 864e5);
  const h = Math.floor((diff % 864e5) / 36e5);
  const m = Math.floor((diff % 36e5) / 6e4);
  el.textContent = `Next: ${next.label} in ${d}d ${h}h ${m}m`;
}

/* ---------- INIT ---------- */
initialRender();
updateAll();
updateCountdown();
setInterval(updateAll, 1800000); // 30 min
setInterval(updateCountdown, 60000); // 1 min
</script>
</body>
</html>
