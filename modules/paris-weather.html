<div class="module-header">
  <h2><i class="fas fa-cloud-sun-rain"></i> Paris weather</h2>
  <p class="panel-subtitle">
    Today and next five days Â· Data from Open-Meteo Â· Central Paris
  </p>
</div>

<div id="paris-weather-days" class="weather-grid">
  <p>Loading forecastâ€¦</p>
</div>

<script>
  // Map Open-Meteo weather codes â†’ simple emoji icon
  function parisWeatherIcon(code) {
    if (code === 0) return "â˜€ï¸";                 // clear
    if (code === 1) return "ğŸŒ¤ï¸";                 // mainly clear
    if (code === 2) return "â›…";                  // partly cloudy
    if (code === 3) return "â˜ï¸";                 // overcast
    if (code === 45 || code === 48) return "ğŸŒ«ï¸"; // fog
    if ([51, 53, 55].includes(code)) return "ğŸŒ¦ï¸"; // drizzle
    if ([61, 63, 65, 80, 81, 82].includes(code)) return "ğŸŒ§ï¸"; // rain
    if ([71, 73, 75, 85, 86].includes(code)) return "â„ï¸";      // snow
    if ([95, 96, 99].includes(code)) return "â›ˆï¸";              // storm
    return "ğŸŒ¡ï¸";
  }

  async function loadParisWeather() {
    const url =
      "https://api.open-meteo.com/v1/forecast" +
      "?latitude=48.8566&longitude=2.3522" +
      "&daily=weathercode,temperature_2m_max,temperature_2m_min" +
      "&timezone=Europe%2FParis";

    let data;

    try {
      const res = await fetch(url, { cache: "no-store" });
      data = await res.json();
    } catch (e) {
      console.warn("Open-Meteo blocked, retrying with proxyâ€¦");
      const proxy =
        "https://cors-proxy.api.exponential-hub.workers.dev/?" + url;
      const res = await fetch(proxy);
      data = await res.json();
    }

    const container = document.getElementById("paris-weather-days");
    if (!container) return;

    container.innerHTML = "";

    const days = data.daily.time;
    const codes = data.daily.weathercode;
    const tmax = data.daily.temperature_2m_max;
    const tmin = data.daily.temperature_2m_min;

    // First 6 days: today + next 5
    for (let i = 0; i < Math.min(6, days.length); i++) {
      const dateObj = new Date(days[i]);
      const pretty = dateObj.toLocaleDateString("en-US", {
        weekday: "short",
        month: "short",
        day: "numeric"
      });

      const icon = parisWeatherIcon(codes[i]);
      const hi = Math.round(tmax[i]);
      const lo = Math.round(tmin[i]);

      // Link out to a real forecast page for that date
      const iso = dateObj.toISOString().slice(0, 10); // YYYY-MM-DD
      const link =
        "https://www.meteofrance.com/previsions-meteo-france/paris-75000?day=" +
        encodeURIComponent(iso);

      const card = document.createElement("div");
      card.className = "weather-day";

      card.innerHTML = `
        <a href="${link}" target="_blank" rel="noopener noreferrer">
          <div class="weather-emoji">${icon}</div>
          <div class="weather-date">${pretty}</div>
          <div class="weather-temps">${hi}Â° / ${lo}Â°C</div>
        </a>
      `;

      container.appendChild(card);
    }
  }
</script>
